---
// COMPONENTS
import BioWrapper from "../../components/biography/BioWrapper.astro";
import HeaderWrapper from "../../components/global/header/HeaderWrapper.astro";
import ScrollArrow from "../../components/global/ScrollArrow.astro";
import Section from "../../components/global/Section.astro";
import InfoOverlay from "../../components/global/InfoOverlay.astro";
import Chapter from "../../components/biography/Chapter.astro";

import { common, junostAssets } from "../../data/data";



const dogSlider = [junostAssets.uvarovYoung1, junostAssets.handwrite1Full];
const uvarovYoung = [junostAssets.uvarovYoung2Full];
const graf = [junostAssets.graf];
const diploma = [junostAssets.diploma];
---

<style>
    .splide__arrow {
        background: transparent;
        width: auto;
    }

</style>

<BioWrapper>
    <!-- Scroll Arrow -->
    <ScrollArrow />

    <!-- Chapter Intro -->
    <Chapter />

    <!-- Header -->
    <HeaderWrapper />

    <!-- Was Born -->
    <Section id="was-born" extraHvh="h-[90vh]">
        <div class="flex flex-col justify-start items-center w-full h-screen relative">
            <p class="text-center font-medium max-w-6xl text-5xl leading-normal pt-[8vh]">
                А. С. Уваров, родился 28 февраля
                <br>
                (11 марта) 1824 года в Петербурге.
            </p>
            <img src={junostAssets.spb.src} alt={junostAssets.spb.alt} class="max-h-[500px] absolute bottom-0" />
        </div>
    </Section> 

    <!-- Father / Mother -->
    <div class="relative w-full">
        <div id="room-bg" class="fixed top-0 left-0 w-full h-full bg-[url('../data/biography/_images/junost/room.png')] bg-center bg-cover z-0 transition-opacity duration-1000 opacity-0"></div>

        <!-- Father section -->
        <Section id="father" bgClass="none" extraHvh="h-[90vh]">
            <div class="h-full w-full flex justify-center items-center">
                <div class="grid grid-cols-2 gap-4 max-w-[1440px]">
                    <div class="flex items-center justify-center">
                        <img src={junostAssets.father.src} alt={junostAssets.father.alt} class="father-img h-auto max-h-full">
                    </div>
            
                    <div class="flex flex-col justify-between gap-y-12 items-center h-full py-24 font-medium text-right text-3xl">
                        <p class="top-text max-w-3xl">
                            Семейными связями и родословной А. С. Уваров был укоренен в русской культуре и государственности, а ряд исторических событий XIX века являлись для него частью семейной хроники.
                        </p>
                        <p class="bottom-text max-w-3xl">
                            Отец Алексея Сергеевича, Сергей Семенович Уваров (1786–1855) – выдающийся государственный деятель, президент Петербургской Академии наук (1818–1855), министр народного просвещения (1833–1849), с именем которого связано становление в России системы общественного образования.
                        </p>
                    </div>
                </div>
            </div>
        </Section>

        <!-- Mother section -->
        <Section id="mother" bgClass="none" extraHvh="h-[90vh]">
            <div class="h-full w-full flex justify-center items-center">
                <div class="grid grid-cols-2 gap-4 max-w-[1440px]">
                    <div class="flex items-center justify-center">
                        <img src={junostAssets.mother.src} alt={junostAssets.mother.alt} class="mother-img h-auto max-h-full">
                    </div>
            
                    <div class="flex flex-col justify-between gap-y-12 items-center h-full py-24 font-medium text-right text-3xl">
                        <p class="top-text max-w-3xl">
                            Семейными связями и родословной А. С. Уваров был укоренен в русской культуре и государственности, а ряд исторических событий XIX века являлись для него частью семейной хроники.
                        </p>
                        <p class="bottom-text max-w-3xl">
                            Мать А. С. Уварова, Екатерина Алексеевна, урожденная Разумовская – дочь министра народного просвещения Алексея Кирилловича и внучатая племянница Алексея Григорьевича Разумовских.
                        </p>
                    </div>
                </div>
            </div>
        </Section>
    </div>

    <!-- Graf -->
    <Section id="graf" extraHvh="h-[85%]">
        <div class="h-full w-full flex justify-center items-center">
            <div class="grid grid-cols-2 gap-x-16 max-w-[1440px] px-20">

                <div id="graf-image" class="flex flex-col items-center justify-center relative">
                    <img src={junostAssets.graf.src} alt={junostAssets.graf.alt} />
                    <InfoOverlay contentType="image" images={graf} overlayId="graf" iconPosition="absolute bottom-1"/>
                </div>

                <div class="flex flex-col justify-between items-cente font-medium text-right">
                    <p class="text-2xl font-semibold">
                        <span class="italic">
                          «За особливые заслуги и высокие достоинства»
                        </span>
                        <br>
                        <br>
                        Высочайшим указом от 1 июля 1846 года С. С. Уваров был пожалован титулом сиятельного графа с нисходящим потомством.
                    </p>
                    <p class="max-w-md text-md self-end">
                        Патент императора Николая I действительному статскому советнику С. С. Уварову на чин тайного советника.
                    </p>
                </div>

            </div>
        </div>
    </Section>

    <div class="relative w-full">
        <div id="library-bg" class="fixed top-0 left-0 w-full h-full bg-[url('../data/biography/_images/junost/library.png')] bg-center bg-cover bg-no-repeat z-0 transition-opacity duration-1000 opacity-0"></div>
            <!-- Library Slider -->
        <Section id="library" extraHvh="h-[65vh]" extraTvh="bottom-[15vh]">
                <div class="flex flex-col justify-center items-center gap-y-8 ">
                    <p class="max-w-7xl pt-8 font-semibold text-2xl leading-normal">
                        Вся атмосфера семьи Уваровых располагала к занятиям наукой и искусством. Богатейшая библиотека, коллекция живописи и антиков, собранная отцом, давала Алексею Уварову с юных лет возможность общения с ученой и творческой элитой.
                    </p>
                    <div class="w-full max-w-[1440px]">
                        <div x-data="{ init() {
                                new Splide(this.$refs.splide, {
                                    perPage: 3,
                                    perMove: 1,
                                    pagination: false,
                                    breakpoints: {
                                        640: {
                                            perPage: 1,
                                        },
                                    },
                                }).mount();
                            },
                        }">
                            <section
                                class="splide"
                                aria-label="Library Slider"
                                x-ref="splide"
                                style="padding-left: 4rem; padding-right: 4rem;"
                                >
                                
                                <div class="splide__arrows">
                                    <button class="splide__arrow splide__arrow--prev">
                                        <img src={common.prevArrow.src} alt={common.prevArrow.alt}>
                                    </button>
                                    <button class="splide__arrow splide__arrow--next">
                                        <img src={common.nextArrow.src} alt={common.nextArrow.alt}>
                                    </button>
                            </div>

                                <div class="splide__track">
                                    <ul class="splide__list">
                                        {junostAssets.libraryPortraits.map((portrait) => (
                                            <li class="splide__slide flex flex-col justify-center">
                                                <div class="w-[400px] h-[450px]">
                                                    <img
                                                        alt={portrait.alt}
                                                        src={portrait.src}
                                                        class="object-contain bottom-0 w-full h-full"
                                                    />
                                                </div>
                                                <div class="text-center mt-4">
                                                    <h3 class="font-semibold text-lg">{portrait.fullName}</h3>
                                                    <p class="text-sm">{portrait.description}</p>
                                                </div>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
        </Section>
    </div>

    <!-- Father Influence Text -->
    <Section id="father-influence" extraTvh="top-0">
        <div class="max-w-7xl px-10 flex justify-center items-center text-4xl leading-normal font-semibold">
            <p >
                Но главным в формировании личности А.С. Уварова стало влияние отца. Во многом, благодаря ему, Алексей Уваров сложился как человек европейской образованности и глубочайшей преданности России.
            </p>
        </div>
    </Section>

    <!-- Dog Animation -->
    <Section id="dog" extraHvh="h-[70vh]">

            <div class="flex justify-between max-w-[1440px] h-[90%] items-center pt-20 px-40">

                <div class="h-[80vh] relative left-20">
                    <video id="dog-anim" class="object-contain h-full" autoplay muted>
                        <source src={junostAssets.dogAnim.src} type="video/mp4">
                    </video>
                    <InfoOverlay contentType="slider" images={dogSlider} overlayId="dog" iconPosition="absolute bottom-6 left-1/2 transform -translate-x-1/2"/>
                </div>

                <div class="flex flex-col items-center">
                    <img src={junostAssets.handwrite_1.src} alt="Почерк-1" class="h-[80vh] relative right-20" />
                    <p class="text-sm text-right mt-4 self-end pr-20">Алексей Сергеевич Уваров</p>
                </div>

            </div>
    </Section>

    <!-- Uni -->
    <Section id="uni" extraHvh="h-[90vh]">
        <div class="max-w-[1250px] w-full h-[300px] mb-72">
            <p class="text-left font-medium max-w-3xl text-xl leading-normal">

                В детстве и юности, обучаясь дома, по программе отца под его наблюдением, Уваров-младший получил основательную подготовку по истории, словесности, географии, древним и новым европейским языкам, точным и естественным наукам.
                <br>
                <br>
                Интерес к истории, древностям привел его на словесное отделение философского факультета Петербургского университета.
            </p>
        </div>
        <img src={junostAssets.spbgu.src} src={junostAssets.spbgu.alt} class="w-full max-w-[1440px] h-[90%] absolute bottom-0" />
    </Section> 

    <!-- Grefe -->
    <Section id="grefe" extraTvh="top-0">
        <div class="flex flex-col justify-center items-center gap-y-20 max-w-[1440px] text-lg md:text-2xl xl:text-3xl xl:leading-normal font-semibold">
            <p class='w-full max-w-4xl xl:max-w-5xl px-10 xl:px-0'>
                Серьезное влияние на формирование будущего ученого оказали профессор Ф.Б. Грефе, читавший курс греческой словесности, и профессор русской истории Н.Г. Устрялов. 
            </p>
            <p class='w-full max-w-4xl xl:max-w-5xl px-10 xl:px-0'>
                Под его влиянием Уваров выбрал тему диссертации 
                <br>
                <span class="italic">
                    «Исследование, в какой степени дополняются сведения о первом самозванце актами, изданными Археографической комиссией».
                </span>
            </p>
        </div>
    </Section>


    <div class="relative w-full">
        <div id="uvarov-bg" class="fixed top-0 left-0 w-full h-full bg-[url('../data/biography/_images/junost/uvarov_young_2.png')] bg-center bg-cover bg-no-repeat z-0 transition-opacity duration-1000 opacity-0"></div>
        <!-- Uvarov Young -->
        <Section id="u-young" extraTvh="top-[5vh]">
            <div class=" w-full h-full flex justify-center items-center">
                <div class="max-w-[1440px] max-h-[520px] w-full">
                    <div class="h-[530px] w-[550px] overflow-hidden relative scrollable">
                        <div class="absolute h-[1040px] w-[550px]">
                            <img src={junostAssets.handwrite_2.src} alt="Почерк-2" class="h-[1040px] w-full object-cover object-left-top">
                        </div>
                    </div>
                </div>
                <InfoOverlay contentType="image" images={uvarovYoung} isIconInverted={true} overlayId="u-young" iconPosition="absolute bottom-16 left-1/2"/>
            </div>
        </Section>
    </div>

    <!-- Diploma -->
    <Section id="diploma" extraHvh="h-[80vh]" extraTvh="top-[15vh]">
        <div class="h-full w-full flex justify-center items-center">
            <div class="grid grid-cols-[2fr,1fr] gap-x-16 max-w-[1440px] px-20">

                <div id="diploma-image" class="flex flex-col items-center justify-center relative">
                    <img src={junostAssets.diploma.src} alt={junostAssets.diploma.alt} />
                    <InfoOverlay contentType="image" images={diploma} overlayId="diploma" iconPosition="absolute bottom-4"/>
                </div>

                <div class="flex flex-col justify-between items-center font-medium text-right pb-20 pt-2">
                    <p class="text-xl font-semibold">
                        Окончив университет со степенью кандидата в 1845 году, поступил на службу в Министерство иностранных дел.
                    </p>
                    <p class="max-w-md text-sm self-end">
                        Диплом А.С. Уварова об окончании 1-го отделения Философского факультета разряда Общей словесности Санкт-Петербургского университета. 14 июля 1845 г.
                    </p>
                    <p class="max-w-md text-sm self-end">Подписан ректором Санкт-Петербургского университета П. А. Плетнёвым</p>
                    <div class="relative self-end">
                        <p>следующая глава</p>
                        <ScrollArrow position="absolute -bottom-20 left-0 max-w-[200px] w-full" invert="invert" visible="opacity-100" />
                    </div>
                </div>

            </div>
        </div>
    </Section>

    <Section id="expeditions" bgChapter="bg-chapter-bg">
    </Section>

</BioWrapper>


<script>

    // SHARED BG OBSERVER
    const roomBg = document.querySelector('#room-bg') as HTMLElement;
    const libraryBg = document.querySelector('#library-bg') as HTMLElement;
    const uvarovBg = document.querySelector('#uvarov-bg') as HTMLElement;
    const targetSections = document.querySelectorAll('#mother, #father, #library, #u-young');

    let visibleSections = new Set(); // To keep track of visible sections

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                visibleSections.add(entry.target.id); // Add section ID when it enters
            } else {
                visibleSections.delete(entry.target.id); // Remove section ID when it leaves
            }

            // Handle room-bg (mother & father)
            if (visibleSections.has('mother') || visibleSections.has('father')) {
                roomBg.classList.add('opacity-100');
                roomBg.classList.remove('opacity-0');
            } else {
                roomBg.classList.remove('opacity-100');
                roomBg.classList.add('opacity-0');
            }

            // Handle library-bg (library section)
            if (visibleSections.has('library')) {
                libraryBg.classList.add('opacity-100');
                libraryBg.classList.remove('opacity-0');
            } else {
                libraryBg.classList.remove('opacity-100');
                libraryBg.classList.add('opacity-0');
            }

            // Handle uvarov-bg (portrait section)
            if (visibleSections.has('u-young')) {
                uvarovBg.classList.add('opacity-100');
                uvarovBg.classList.remove('opacity-0');
            } else {
                uvarovBg.classList.remove('opacity-100');
                uvarovBg.classList.add('opacity-0');
            }
        });
    }, { threshold: 0.5 });

    // Observe target sections
    targetSections.forEach(section => observer.observe(section));


    // FATHER / MOTHER SCROLL --- GSAP 
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    gsap.registerPlugin(ScrollTrigger);

    function animateSection(sectionId : string, imageSelector : string, bottomTextSelector : string) {
        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: `#${sectionId}`,
                start: "top center",
                end: "bottom top",
                toggleActions: "play none none reverse",
                onLeave: () => { 
                    setTimeout(() => tl.restart(false).pause(), 1000);
                },
                onLeaveBack: () => { 
                    setTimeout(() => tl.restart(false).pause(), 1000);
                },
                onEnter: () => {
                    tl.play();
                },
                onEnterBack: () => { 
                    tl.play();
                }
            }
        });

        tl.fromTo(
            imageSelector,
            { autoAlpha: 0, x: -600 },
            { autoAlpha: 1, x: 0, duration: 1.5, ease: "power2.out" },
            "+=2"
        )
        .fromTo(
            bottomTextSelector,
            { autoAlpha: 0, x: 600 },
            { autoAlpha: 1, x: 0, duration: 1.2, ease: "power2.out" },
            "+=1"
        );
    }

    // Father section
    animateSection("father", "#father img", "#father .bottom-text");
    // Mother section
    animateSection("mother", "#mother img", "#mother .bottom-text");


    // VIDEO PLAY ON HOVER
    const dogAnimation = document.getElementById('dog-anim') as HTMLVideoElement;
    let reverseInterval : any;

    dogAnimation.addEventListener('mouseenter', () => {
        clearInterval(reverseInterval);  // Clear reverse interval if already running
        dogAnimation.play();  // Play the video when mouse enters
    });

    dogAnimation.addEventListener('mouseleave', () => {
        dogAnimation.pause();  // Pause the video on mouse leave
        reverseVideo();  // Start reverse playback
    });

    function reverseVideo() {
        reverseInterval = setInterval(() => {
            if (dogAnimation.currentTime <= 0) {
                clearInterval(reverseInterval);  // Stop when the video reaches the start
            } else {
                dogAnimation.currentTime -= 0.05;  // Move the video time backwards
            }
        }, 50);  // Adjust the speed of reverse playback
    }

    // SCROLL IMAGE IN CONTAINER
    const scrollableElements = document.querySelectorAll(".scrollable") ;

    scrollableElements.forEach((scrollable) => {
        const imageElement = scrollable.querySelector("img") as HTMLElement;

            
        let scrollPosition = 0;
        let targetScrollPosition = 0;
        let isScrolling = false;

        scrollable.addEventListener("wheel", (event : any) => {
            event.preventDefault();

            // Adjust the target scroll position
            const scrollAmount = event.deltaY > 0 ? 100 : -100;
                targetScrollPosition = Math.min(
                Math.max(targetScrollPosition + scrollAmount, 0),
                imageElement.clientHeight - scrollable.clientHeight
                );

                if (!isScrolling) {
                isScrolling = true;
                smoothScroll();
                }
        });

        function smoothScroll() {
            const SCROLL_SPEED = 20;

            if (Math.abs(targetScrollPosition - scrollPosition) > 0.5) {
            scrollPosition += (targetScrollPosition - scrollPosition) / SCROLL_SPEED;
            imageElement.style.transform = `translateY(${-scrollPosition}px)`;

            // Continue the animation until the target position is reached
            requestAnimationFrame(smoothScroll);
            } else {
            isScrolling = false;
            }
        }
            
    });


    // REDIRECT AFTER SCROLL TO EXPEDITIONS
    const expeditions = document.getElementById('expeditions') as HTMLElement;

    const transitionObserver = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                setTimeout(() => {
                    window.location.href = '/biography/expeditions';
                }, 1000);
            }
        });
    }, { threshold: 0.5 });

    transitionObserver.observe(expeditions);

</script>