---
// COMPONENTS
import BioWrapper from "../../components/biography/BioWrapper.astro";
import HeaderWrapper from "../../components/global/header/HeaderWrapper.astro";
import ScrollArrow from "../../components/global/ScrollArrow.astro";
import Section from "../../components/global/Section.astro";
import InfoOverlay from "../../components/global/InfoOverlay.astro";

import { junostAssets } from "../../data/data";
import { getCurrentChapter } from "../../utils/currentChapter.astro";
const currentChapter = getCurrentChapter(Astro);

const sectionTheme = {
    p: "w-full max-w-4xl xl:max-w-6xl px-10 xl:px-0 text-lg md:text-2xl xl:text-5xl xl:leading-relaxed font-semibold",
}

const dogSlider = [junostAssets.uvarovYoung1, junostAssets.handwrite1Full];
const uvarovYoung = [junostAssets.uvarovYoung2];
---

<BioWrapper>
    <!-- Scroll Arrow -->
    <ScrollArrow />

    <!-- Chapter Intro -->
    <Section id="chapter-intro" bgChapter="bg-chapter-bg">
            <img src={currentChapter?.src} alt={currentChapter?.alt} class="max-w-full h-auto px-8 md:px-0" />
    </Section>

    <HeaderWrapper />

    <!-- Was Born -->
    <Section id="was-born">
        <div class="show-up-text-wrapper flex flex-col justify-end items-center h-full py-10">
            <p class="text-hidden text-center font-bold text-black max-w-2xl text-4xl z-5 leading-normal">
                А. С. Уваров, родился 28 февраля (11 марта) 1824 года в Петербурге.
            </p>
            <img src={junostAssets.spb.src} alt={junostAssets.spb.alt} class="h-[70%] z-10" />
        </div>
    </Section> 

    <!-- Parents Text -->
    <Section id="parents-text">
        <p class=`${sectionTheme.p}`>
            Семейными связями и родословной А. С. Уваров был укоренен в русской культуре и государственности, а ряд исторических событий XIX века являлись для него частью семейной хроники.
        </p>
    </Section>

    <!-- Father / Mother -->
    <Section id="father-mother">
        <div class="father-mother-wrapper">
            <div class="bg-[url('../data/biography/_images/junost/room.png')] bg-center bg-cover w-full h-full">
                <div class="father-wrapper fixed flex justify-between items-center px-20 font-semibold h-[90%]">
                    <img src={junostAssets.father.src} alt={junostAssets.father.alt} class="h-auto max-h-full">
                    <p class="max-w-3xl">Отец Алексея Сергеевича, Сергей Семенович Уваров (1786–1855) – выдающийся государственный деятель, президент Петербургской Академии наук (1818–1855), министр народного просвещения (1833–1849), с именем которого связано становление в России системы общественного образования.</p>
                </div>
                <div class="mother-wrapper fixed flex justify-between items-center px-20 font-semibold h-[90%]">
                    <img src={junostAssets.mother.src} alt={junostAssets.mother.alt} class="h-auto max-h-full">
                    <p class="max-w-3xl">Мать А. С. Уварова, Екатерина Алексеевна, урожденная Разумовская – дочь министра народного просвещения Алексея Кирилловича и внучатая племянница Алексея Григорьевича Разумовских.</p>
                </div>
            </div>
        </div>
            
      </Section>

      <!-- Graf Text -->
    <Section id="graf-text">
        <p class=`${sectionTheme.p}`>
            <span class="italic">
                «За особливые заслуги и высокие достоинства»
            </span> 
            <br>
            <br>
            Высочайшим указом от 1 июля 1846 года С. С. Уваров был пожалован титулом сиятельного графа с нисходящим потомством.
        </p>
    </Section>

    <!-- Graf Image -->
    <Section id="graf">
        <img src={junostAssets.graf.src} alt={junostAssets.graf.alt} class="max-h-[75%]" />
    </Section>

    <!-- Science Text -->
    <Section id="library-text">
        <p class='w-full max-w-4xl xl:max-w-6xl px-10 xl:px-0 text-lg md:text-2xl xl:text-4xl xl:leading-relaxed font-semibold text-justify'>
            Вся атмосфера семьи Уваровых располагала к занятиям наукой и искусством. Богатейшая библиотека, коллекция живописи и антиков, собранная отцом, давала Алексею Уварову с юных лет возможность общения с ученой и творческой элитой.
        </p>
    </Section>
    
    
    <!-- Science Slider -->
    <Section id="library">
        <div class="bg-[url('../data/biography/_images/junost/library.png')] bg-center bg-cover py-28 w-full h-full">
            <div class="w-full h-[70%]">
                <div x-data="{ init() {
                        new Splide(this.$refs.splide, {
                            perPage: 3,
                            perMove: 1,
                            pagination: false,
                            breakpoints: {
                                640: {
                                    perPage: 1,
                                },
                            },
                        }).mount();
                    },
                }">
                    <section
                        class="splide"
                        aria-label="Science Portraits Slider"
                        x-ref="splide">
                        <div class="splide__track">
                            <ul class="splide__list">
                                {junostAssets.libraryPortraits.map((portrait) => (
                                    <li class="splide__slide flex justify-center">
                                        <div class="w-[400px] h-[500px]">
                                            <img
                                                alt={portrait.alt}
                                                src={portrait.src}
                                                class="object-cover bottom-0 w-full h-full"
                                            />
                                        </div>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </Section>

    <!-- Father Influence Text -->
    <Section id="dog-text">
            <p class=`${sectionTheme.p}`>
                Но главным в формировании личности А.С. Уварова стало влияние отца. Во многом, благодаря ему, Алексей Уваров сложился как человек европейской образованности и глубочайшей преданности России.
            </p>
    </Section>

    <!-- Dog Animation -->
    <Section id="dog">
        <div class="w-full h-[90%] flex justify-center items-center">
            <video id="dog-anim" class="object-cover h-[75%] relative left-20" autoplay muted>
                <source src={junostAssets.dogAnim.src} type="video/mp4">
            </video>
            <img src={junostAssets.handwrite_1.src} alt="Почерк-1" class="max-h-[75%] relative right-20 hover:filter hover:drop-shadow-[0_15px_5px_rgba(0,0,0,0.9)] transition-filter duration-300" />

            <InfoOverlay contentType="slider" images={dogSlider} overlayId="dog"/>
        </div>
    </Section>

    <!-- Education Text Scroll Up -->
    <Section id="uni">
        <div class="show-up-text-wrapper flex flex-col justify-center items-center h-full py-20">
            <p class="text-hidden text-left font-bold text-black max-w-3xl text-lg z-5 leading-snug relative top-16 -left-10">
                В детстве и юности, обучаясь дома, по программе отца под его наблюдением, Уваров-младший получил основательную подготовку по истории, словесности, географии, древним и новым европейским языкам, точным и естественным наукам. Интерес к истории, древностям привел его на словесное отделение философского факультета Петербургского университета.
            </p>
            <img src={junostAssets.spbgu.src} src={junostAssets.spbgu.alt} class="max-w-full h-[80%] z-10" />
        </div>
    </Section> 

    <!-- Grefe -->
    <Section id="grefe">
        <div class="flex flex-col gap-y-20">
            <p class='w-full max-w-4xl xl:max-w-6xl px-10 xl:px-0 text-lg md:text-2xl xl:text-4xl xl:leading-normal font-semibold text-justify'>
                Серьезное влияние на формирование будущего ученого оказали профессор Ф.Б. Грефе, читавший курс греческой словесности, и профессор русской истории Н.Г. Устрялов. 
            </p>
            <p class='w-full max-w-4xl xl:max-w-6xl px-10 xl:px-0 text-lg md:text-2xl xl:text-4xl xl:leading-normal font-semibold text-justify'>
                Под его влиянием Уваров выбрал тему диссертации 
                <br>
                <span class="italic">
                    «Исследование, в какой степени дополняются сведения о первом самозванце актами, изданными Археографической комиссией».
                </span>
            </p>
        </div>
    </Section>

    <!-- Uvarov Young -->
    <Section id="u-young">
        <div class="bg-[url('../data/biography/_images/junost/uvarov_young_2.png')] w-full h-full bg-no-repeat bg-[top_-200px_left] flex justify-between items-center px-40" style="background-size: 120%;">
            <div class="h-[60vh] w-[40vw] overflow-hidden">
                <img src={junostAssets.handwrite_2.src} alt="Почерк-2" class="h-full w-full object-cover object-left-top">
            </div>
            <!-- <div class="info-icon-young z-120 cursor-pointer">
                <i class="fas fa-info-circle text-2xl text-white"></i>
            </div> -->

            <InfoOverlay contentType="image" images={uvarovYoung} isIconInverted={true} overlayId="u-young"/>
        </div>
    </Section>

    <!-- Father Influence Text -->
    <Section id="diploma-text">
        <p class=`${sectionTheme.p}`>
            Окончив университет со степенью кандидата в 1845 году, поступил на службу в Министерство иностранных дел.
        </p>
    </Section>

    <!-- Diploma Image -->
    <Section id="diploma">
        <img src={junostAssets.diploma.src} alt="Диплом" class="max-h-[85%]" />
    </Section>

</BioWrapper>


<script>

    // FATHER + MOTHER --- GSAP
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    // Create a GSAP timeline for both father and mother animations
    const fatherMotherTimeline = gsap.timeline({
        scrollTrigger: {
            trigger: ".father-mother-wrapper",
            start: "top 75%", // Trigger the animation when the Section hits 75% of the viewport height
            end: "bottom 25%", // End when the bottom of the Section hits 25% of the viewport
            scrub: 1.5, // Link the animation to the scroll position more smoothly
            toggleActions: "play none none reverse", // Play forward on enter, reverse on leave
            invalidateOnRefresh: true, // Recalculate positions on refresh
        }
    });

    // Father animation - comes from the left and then moves away
    fatherMotherTimeline
        .fromTo(
            ".father-wrapper",
            { x: "-120%", opacity: 0 }, // Initially off-screen to the left
            { x: "0%", opacity: 1, duration: 1.5, ease: "power2.inOut" } // Smoothly scrolls in and appears
        )
        .to(
            ".father-wrapper",
            { x: "-120%", opacity: 0, duration: 1.5, ease: "power2.inOut" }, // Moves out smoothly
            "+=1" // Slight pause before it scrolls out
        );

    // Mother animation - stays on screen after the father moves out
    fatherMotherTimeline
        .fromTo(
            ".mother-wrapper",
            { x: "120%", opacity: 0 }, // Initially off-screen to the right
            { x: "0%", opacity: 1, duration: 1.5, ease: "power2.inOut" }, // Smoothly scrolls in and appears
            "-=1" // Mother comes in slightly before the father moves away
        )
        .to(
            ".mother-wrapper",
            { opacity: 1, duration: 2 }, // Keep mother visible without moving her out
            "+=0.5"
        );

    // VIDEO PLAY ON HOVER
    const dogAnimation = document.getElementById('dog-anim') as HTMLVideoElement; // Use getElementById instead of querySelector
    let reverseInterval : any;

    dogAnimation.addEventListener('mouseenter', () => {
        clearInterval(reverseInterval);  // Clear reverse interval if already running
        dogAnimation.play();  // Play the video when mouse enters
    });

    dogAnimation.addEventListener('mouseleave', () => {
        dogAnimation.pause();  // Pause the video on mouse leave
        reverseVideo();  // Start reverse playback
    });

    function reverseVideo() {
        reverseInterval = setInterval(() => {
            if (dogAnimation.currentTime <= 0) {
                clearInterval(reverseInterval);  // Stop when the video reaches the start
            } else {
                dogAnimation.currentTime -= 0.05;  // Move the video time backwards
            }
        }, 50);  // Adjust the speed of reverse playback
    }

</script>