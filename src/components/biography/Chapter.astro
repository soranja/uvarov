---
import { getCurrentChapter } from "../../utils/currentChapter.astro";
const currentChapter = getCurrentChapter(Astro);
import ScrollArrow from "../../components/global/ScrollArrow.astro";

---

<section id="chapter-intro" class="section relative w-full min-h-screen grid place-items-center content-center">
    <div class="fixed-wrapper flex items-center justify-center w-full h-screen bg-chapter-bg fixed top-0 left-0 bg-cover bg-no-repeat transform-all duration-1000 ease-in-out">
        <ScrollArrow size="w-3/4" position="absolute bottom-6 transform -translate-x-1/2"/>
        {currentChapter ? (
            <img 
                src={currentChapter.src} 
                alt={currentChapter.alt} 
                class="max-w-full h-auto px-8 md:px-0" 
            />
        ) : (
            <p class="text-white">Chapter not found</p>
        )}
    </div>
</section>

<script>

    // SCROLL FADE CHAPTER OBSERVER
    const scrollArrow = document.querySelector("#scroll-arrow") as HTMLElement;
    const introSection = document.querySelector("#chapter-intro") as HTMLElement;

    const introObserver = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.target.id === "chapter-intro") {
                if (entry.isIntersecting) {
                    scrollArrow.classList.add('opacity-100');
                } else {
                    scrollArrow.classList.remove('opacity-100');
                }
            }
        });
    }, { threshold: [0.5, 0.7] });

    introObserver.observe(introSection);
</script>